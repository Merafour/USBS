From: WizBrother WizMime<support@wizbrother.com>
Subject: =?gb2312?B?VVNCU9LG1rIgU1RNMzJGNCBOTzmjutL9tby5zLz+KEFwcCk=?=
Date: Date: Fri, 19 Jun 2015 01:03:21 +0800
MIME-Version: 1.0
Content-Type: multipart/related;
	type="multipart/alternative";
	boundary="----=_Next_Part_0174995202.995"

This is a multi-part message in MIME format.

------=_Next_Part_0174995202.995
Content-Type: multipart/alternative;
	boundary="----=_Next_Part_0058331734.942"


------=_Next_Part_0058331734.942
Content-Type: text/plain;
	charset="gb2312"
Content-Transfer-Encoding: quoted-printable

This is a multi-part message in MIME format.

------=_Next_Part_0058331734.942
Content-Type: text/html;
	charset="gb2312"
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">=0A=
<HTML><HEAD>=0D=0A<meta http-equiv=3D"Content-Type" content=3D"te=
xt/html; charset=3Dgb2312"><TITLE>USBS=D2=C6=D6=B2 STM32F4 NO9=A3=
=BA=D2=FD=B5=BC=B9=CC=BC=FE(App)</TITLE>=0A=0A<STYLE type=3Dtext/=
css>=0Abody, p, th, td, li, ul, ol, h1, h2, h3, h4, h5, h6, pre=0A=
{=0A	font-family: =CB=CE=CC=E5;=0A	line-height: 1.4;=0A}=0Abody,=20=
p, th, td, li, ul, ol, pre=0A{=0A	font-size: 12px;=0A}=0A</STYLE>=
=0A=0A<META content=3D"MSHTML 6.00.2900.6550" name=3DGENERATOR></=
HEAD>=0A<BODY><FONT face=3D"Times New Roman"><FONT size=3D7><STRO=
NG>USBS=D2=C6=D6=B2 STM32F4 =0ANO9=A3=BA=D2=FD=B5=BC=B9=CC=BC=FE(=
App)<BR></STRONG></FONT><FONT =0Asize=3D3>&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =0A--------<SPAN clas=
s=3DApple-converted-space>&nbsp;</SPAN></FONT></FONT><SPAN =0Asty=
le=3D"FONT-FAMILY: =CB=CE=CC=E5"><FONT size=3D3>=D7=AA=D4=D8=C7=EB=
=D7=A2=C3=F7=B3=F6=B4=A6<BR><FONT =0Aface=3D"Times New Roman">&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =0A=
--------<SPAN class=3DApple-converted-space>&nbsp;=B8=FC=B6=E0=B1=
=CA=BC=C7=C7=EB=B7=C3=CE=CA=A3=BA<A =0Ahref=3D"http://merafour.bl=
og.163.com/">merafour.blog.163.com</A>&nbsp;</SPAN></FONT></FONT>=
</SPAN> =0A=0A<P class=3DMsoNormal =0Astyle=3D"MARGIN: 0cm 0cm 0p=
t; WORD-SPACING: 0px; FONT: 12px/16px =CB=CE=CC=E5; TEXT-TRANSFOR=
M: none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal=
; LETTER-SPACING: normal; orphans: auto; widows: auto; webkit-tex=
t-stroke-width: 0px"><FONT =0Asize=3D3><SPAN style=3D"FONT-FAMILY=
: =CB=CE=CC=E5"><SPAN lang=3DEN-US><FONT =0Aface=3D"Times New Rom=
an">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp; =0A</FONT></SPAN></SPAN><SPAN lang=3DEN-US><FONT face=3D"Ti=
mes New Roman">-------- =0A2015-6-16.</FONT></SPAN><SPAN style=3D=
"FONT-FAMILY: =CB=CE=CC=E5">=C0=E4=D4=C2=D7=B7=B7=E7</SPAN><SPAN=20=
=0Alang=3DEN-US><FONT face=3D"Times New Roman"></FONT></SPAN></FO=
NT></P>=0A<P class=3DMsoNormal =0Astyle=3D"MARGIN: 0cm 0cm 0pt; W=
ORD-SPACING: 0px; FONT: 12px/16px =CB=CE=CC=E5; TEXT-TRANSFORM: n=
one; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal; LE=
TTER-SPACING: normal; orphans: auto; widows: auto; webkit-text-st=
roke-width: 0px"><FONT =0Asize=3D3><SPAN lang=3DEN-US><FONT =0Afa=
ce=3D"Times New Roman"><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<SPAN =0Aclass=3DApple-converted-sp=
ace>&nbsp;</SPAN></SPAN>-------- =0Aemail</FONT></SPAN><SPAN styl=
e=3D"FONT-FAMILY: =CB=CE=CC=E5">=A3=BA</SPAN><SPAN lang=3DEN-US><=
FONT =0Aface=3D"Times New Roman"><A =0Ahref=3D"mailto:merafour@16=
3.com">merafour@163.com</A><SPAN =0Aclass=3DApple-converted-space=
>&nbsp;</SPAN></FONT></SPAN></FONT><BR></P>=0A<HR>=0A=0A<P class=3D=
MsoNormal =0Astyle=3D"MARGIN: 0cm 0cm 0pt; WORD-SPACING: 0px; FON=
T: 12px/16px =CB=CE=CC=E5; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0=
); TEXT-INDENT: 0px; WHITE-SPACE: normal; LETTER-SPACING: normal;=
 orphans: auto; widows: auto; webkit-text-stroke-width: 0px"><BR>=
<FONT =0Acolor=3D#ff0000>&nbsp;&nbsp;&nbsp; <STRONG><SPAN id=3Dwi=
z_font_size_span_25612281 =0Astyle=3D"FONT-SIZE: 16pt"><STRONG>US=
BS</STRONG></SPAN></STRONG>=D7=EE=B3=F5=CA=C7=B1=CA=D5=DF=BB=F9=D3=
=DA =0ASTM32F103=CF=B5=C1=D0=BF=AA=B7=A2=B3=F6=C0=B4=B5=C4=D2=BB=B8=
=F6 =0Abootloader=A3=AC=CD=A8=B9=FD=B0=D1=C9=E8=B1=B8=D7=F6=B3=C9=
=D2=BB=B8=F6USB=BD=D3=BF=DA=B5=C4=B4=E6=B4=A2=C9=E8=B1=B8=BC=B4U=C5=
=CC=B4=D3=B6=F8=B0=DA=CD=D1=D2=D4=CD=F9=C9=FD=BC=B6=B9=CC=BC=FE=B9=
=FD=B3=CC=D6=D0=CB=F9=D0=E8=D2=AA=B5=C4=C9=CF=CE=BB=BB=FA=B8=FA=C7=
=FD=B6=AF(=BC=B4=C3=E2=C7=FD)=A1=A3USBS=C8=AB=B3=C6=CA=C7=A3=BA"U=
SB =0AStorage"=A3=AC=BE=DF=D3=D0=D2=BB=CF=C2=CC=D8=B5=E3=A3=BA<BR=
><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =D2=BB=A1=A2=D6=BB=
=D2=AA=C4=E3=B5=C4=B2=D9=D7=F7=CF=B5=CD=B3=D6=A7=B3=D6 =0AU=C5=CC=
=D4=AD=D4=F2=C9=CF=B6=BC=BF=C9=D2=D4=CA=B9=D3=C3=A3=AC=C4=BF=C7=B0=
=D2=D1=BE=AD=B2=E2=CA=D4=C1=CB =0AWindows=A1=A2Ubuntu=B8=FA=C6=BB=
=B9=FB=A3=BB<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =B6=FE=
=A1=A2=BF=C9=CD=A8=B9=FD =0APC=B6=CB=C8=ED=BC=FE=C5=E4=D6=C3=CB=F9=
=CA=B9=D3=C3=B5=C4 IO=B2=A2=C9=E8=D6=C3=C6=E4=D3=E0 IO=B5=C4=C4=AC=
=C8=CF=CA=E4=B3=F6=A3=AC=D2=B2=BE=CD=CA=C7=CB=B5=BC=EC=B2=E2 IO=B8=
=FA LED=D6=B8=CA=BE =0AIO=D3=C3=BB=A7=BF=C9=D2=D4=D7=D4=B6=A8=D2=E5=
=A3=BB<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =C8=FD=A1=A2=
=D7=D4=B4=F8=B2=BB=D2=C0=C0=B5=CD=E2=B2=BF EEPROM=B5=C4=BC=D3=C3=DC=
=CB=E3=B7=A8=A3=AC =0A32B=BC=D3=C3=DC=CA=FD=BE=DD=C8=B7=B1=A3=B3=CC=
=D0=F2=B6=C1=B5=BD=C1=ED=CD=E2=D2=BB=BF=C5 IC=C9=CF=B2=BB=C4=DC=D4=
=CB=D0=D0=A3=BB<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =CB=
=C4=A1=A2=CE=AA =0AApp=CC=E1=B9=A9=B5=A5=B6=C0=B5=C4=BC=D3=C3=DC=CB=
=E3=B7=A8(32B)=A3=AC=D3=C3=BB=A7=BF=C9=CD=A8=B9=FD PC=C8=ED=BC=FE=
=C9=E8=D6=C3=BC=D3=C3=DC "licence"=A1=A3</FONT><BR><BR>&nbsp;&nbs=
p;&nbsp; =0A<STRONG><SPAN id=3Dwiz_font_size_span_17581296 =0Asty=
le=3D"FONT-SIZE: 16pt"><STRONG>=BD=F1</STRONG></SPAN></STRONG>=CC=
=EC=CE=D2=C3=C7=D2=AA=D4=F6=BC=D3=C1=ED=CD=E2=D2=BB=B8=F6=B9=A6=C4=
=DC=A3=BA=D2=FD=B5=BC=B9=CC=BC=FE=A1=A3=D5=E2=B8=F6=B9=A6=C4=DC=CA=
=B5=CF=D6=D6=AE=BA=F3=CE=D2=C3=C7=BE=CD=CA=B5=CF=D6=C1=CB=D2=BB=B8=
=F6=BE=DF=B1=B8 =0Abootloader=D7=EE=BB=F9=B1=BE=B5=C4=B9=A6=C4=DC=
=B5=C4 USBS=A3=AC=D4=DA=CD=F9=CF=C2=CE=D2=C3=C7=BE=CD=BF=C9=D2=D4=
=C8=A5=CA=B5=CF=D6=B6=CB=BF=DA=C5=E4=D6=C3=B8=FA=BC=D3=C3=DC=A3=AC=
=D5=E2=D1=F9=CE=D2=C3=C7=BE=CD=CA=B5=CF=D6=C1=CB=D2=BB=B8=F6=CD=EA=
=D5=FB=B5=C4 =0AUSBS=A1=A3&nbsp;&nbsp;<BR><BR>&nbsp;&nbsp;&nbsp;=20=
<SPAN id=3Dwiz_font_size_span_28458765 =0Astyle=3D"FONT-SIZE: 16p=
t"><STRONG>=CD=AC</STRONG></SPAN>=D1=F9=BD=AB=C9=CF=D2=BB=B2=BD=B5=
=C4=D4=B4=C2=EB=BF=BD=B1=B4=D2=BB=B7=DD=A3=AC=B2=A2=C3=FC=C3=FB=CE=
=AA=A3=BAUSBS_V0.8.21=A1=A3</P>=0A<P class=3DMsoNormal =0Astyle=3D=
"MARGIN: 0cm 0cm 0pt; WORD-SPACING: 0px; FONT: 12px/16px =CB=CE=CC=
=E5; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; W=
HITE-SPACE: normal; LETTER-SPACING: normal; orphans: auto; widows=
: auto; webkit-text-stroke-width: 0px">&nbsp;</P>=0A<P class=3DMs=
oNormal =0Astyle=3D"MARGIN: 0cm 0cm 0pt; WORD-SPACING: 0px; FONT:=
 12px/16px =CB=CE=CC=E5; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0);=
 TEXT-INDENT: 0px; WHITE-SPACE: normal; LETTER-SPACING: normal; o=
rphans: auto; widows: auto; webkit-text-stroke-width: 0px">&nbsp;=
&nbsp;&nbsp; =0A<STRONG><SPAN id=3Dwiz_font_size_span_1466765 =0A=
style=3D"FONT-SIZE: 16pt"><STRONG>=C8=E7</STRONG></SPAN></STRONG>=
=B9=FB=C4=E3=B2=BB=D6=AA=B5=C0=D4=F5=D1=F9=D2=FD=B5=BC App=BF=C9=D2=
=D4=B2=CE=BF=BC =0AST=BF=E2=D6=D0=B5=C4 DFU=C0=FD=B3=CC=A3=BA<BR>=
</P>=0A<DIV =0Astyle=3D"BORDER-RIGHT: black 1px solid; PADDING-RI=
GHT: 3px; BORDER-TOP: black 1px solid; PADDING-LEFT: 3px; FONT-SI=
ZE: 12px; MARGIN-LEFT: auto; BORDER-LEFT: black 1px solid; COLOR:=
 black; MARGIN-RIGHT: auto; PADDING-TOP: 3px; BORDER-BOTTOM: blac=
k 1px solid; FONT-FAMILY: Courier New; BACKGROUND-COLOR: window;=20=
TEXT-ALIGN: left; 3px: ">&nbsp;&nbsp;<FONT =0Acolor=3D#0000ff><B>=
if</B></FONT> (STM_EVAL_PBGetState(Button_KEY) <FONT =0Acolor=3D#=
333399>!=3D</FONT> 0x00)<BR>&nbsp;&nbsp;{ <FONT color=3D#008000>/=
* Test if =0Auser code is programmed starting from address 0x800C=
000 =0A*/</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT color=3D#0000ff=
><B>if</B></FONT> =0A(((<FONT color=3D#333399>*</FONT>(__IO uint3=
2_t<FONT =0Acolor=3D#333399>*</FONT>)APP_DEFAULT_ADD) <FONT color=
=3D#333399>&amp;</FONT> =0A0x2FFE0000 ) <FONT color=3D#333399>=3D=
=3D</FONT> =0A0x20000000)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <FONT colo=
r=3D#008000>/* Jump to user =0Aapplication */</FONT><BR>&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;JumpAddress <FONT =0Acolor=3D#333399>=3D=
</FONT> <FONT color=3D#333399>*</FONT>(__IO uint32_t<FONT =0Acolo=
r=3D#333399>*</FONT>) (APP_DEFAULT_ADD <FONT color=3D#333399>+</F=
ONT> <FONT =0Acolor=3D#6e00aa>4</FONT>);<BR>&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;Jump_To_Application =0A<FONT color=3D#333399>=3D</=
FONT> (pFunction) =0AJumpAddress;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;<FONT color=3D#008000>/* =0AInitialize user application's=
 Stack Pointer =0A*/</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;__set_MSP(<FONT =0Acolor=3D#333399>*</FONT>(__IO uint32_t<FONT=20=
color=3D#333399>*</FONT>) =0AAPP_DEFAULT_ADD);<BR>&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;Jump_To_Application();<BR>&nbsp;&nbsp;&nbsp;=
&nbsp;}<BR>&nbsp;&nbsp;} =0A<FONT color=3D#008000>/* Otherwise en=
ters DFU mode to allow user to program his =0Aapplication */</FON=
T></DIV>=0A<P class=3DMsoNormal =0Astyle=3D"MARGIN: 0cm 0cm 0pt;=20=
WORD-SPACING: 0px; FONT: 12px/16px =CB=CE=CC=E5; TEXT-TRANSFORM:=20=
none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal; L=
ETTER-SPACING: normal; orphans: auto; widows: auto; webkit-text-s=
troke-width: 0px"><BR>=CB=F9=D2=D4=CE=D2=C3=C7=D0=E8=D2=AA=CF=C8=D4=
=F6=BC=D3=D2=BB=B8=F6=B0=B4=BC=FC=D2=D4=D1=A1=D4=F1=CA=C7=C9=FD=BC=
=B6=B9=CC=BC=FE=BB=B9=CA=C7=D2=FD=B5=BC =0AApp=A1=A3=D5=E2=B8=F6=CE=
=D2=C3=C7=D2=C0=C8=BB=BF=C9=D2=D4=B2=CE=BF=BC ST=B0=E5=D7=D3=B5=C4=
=B4=FA=C2=EB=A1=A3=C8=BB=BA=F3=CE=D2=C3=C7=D4=DA Board.h=B8=FA Bo=
ard.c=D6=D0=CC=ED=BC=D3=C8=E7=CF=C2=B4=FA=C2=EB=A3=BA<BR></P>=0A<=
DIV =0Astyle=3D"BORDER-RIGHT: black 1px solid; PADDING-RIGHT: 3px=
; BORDER-TOP: black 1px solid; PADDING-LEFT: 3px; FONT-SIZE: 12px=
; MARGIN-LEFT: auto; BORDER-LEFT: black 1px solid; COLOR: black;=20=
MARGIN-RIGHT: auto; PADDING-TOP: 3px; BORDER-BOTTOM: black 1px so=
lid; FONT-FAMILY: Courier New; BACKGROUND-COLOR: window; TEXT-ALI=
GN: left; 3px: "><FONT =0Acolor=3D#008000>// Board.h</FONT><BR>#<=
FONT color=3D#0000ff><B>define</B></FONT> =0ABUTTONn&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;<FONT =0Acolor=3D#6e00aa>1</FONT> <FONT color=3D#008=
000>/*!&lt; Joystick pins are connected =0Ato&nbsp;<BR>&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;an =0AIO Expander (accessible =0Athrough&nbsp;<=
BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I2C1 =0Ainterface) */</FONT><BR><F=
ONT color=3D#008000>/**<BR>&nbsp;* @brief Key =0Apush-button<BR>&=
nbsp;*/</FONT><BR>#<FONT color=3D#0000ff><B>define</B></FONT> =0A=
KEY_BUTTON_PIN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GP=
IO_Pin_4<BR>#<FONT =0Acolor=3D#0000ff><B>define</B></FONT> =0AKEY=
_BUTTON_GPIO_PORT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GPIOE<BR>#<FONT =0Acolor=3D#0000ff>=
<B>define</B></FONT> =0AKEY_BUTTON_GPIO_CLK&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RCC=
_AHB1Periph_GPIOE<BR><FONT =0Acolor=3D#0000ff><B>void</B></FONT>=20=
Board_PBInit(<FONT =0Acolor=3D#0000ff><B>void</B></FONT>);<BR>uin=
t32_t Board_PBGetState(<FONT =0Acolor=3D#0000ff><B>void</B></FONT=
>);<BR><FONT color=3D#008000>=0A<HR>=0A// Board.c</FONT><BR>GPIO_=
TypeDef<FONT color=3D#333399>*</FONT> =0ABUTTON_PORT[BUTTONn] <FO=
NT color=3D#333399>=3D</FONT> =0A{KEY_BUTTON_GPIO_PORT};&nbsp;<BR=
><FONT color=3D#0000ff><B>const</B></FONT> =0Auint16_t BUTTON_PIN=
[BUTTONn] <FONT color=3D#333399>=3D</FONT> =0A{KEY_BUTTON_PIN};&n=
bsp;<BR><FONT color=3D#0000ff><B>const</B></FONT> uint32_t =0ABUT=
TON_CLK[BUTTONn] <FONT color=3D#333399>=3D</FONT> {KEY_BUTTON_GPI=
O_CLK};<BR><FONT =0Acolor=3D#008000>/**<BR>&nbsp;&nbsp;* @brief&n=
bsp;&nbsp;Configures Button GPIO and =0AEXTI Line.<BR>&nbsp;&nbsp=
;* @param&nbsp;&nbsp;Button: Specifies the Button to be =0Aconfig=
ured.<BR>&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;This parameter can be one=
 of =0Afollowing =0Aparameters:&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;=
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@arg =0ABUTTON_KEY: Key Push =0ABu=
tton&nbsp;<BR>&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;generation =0Acapability&nbsp;&nbsp;<BR>&n=
bsp;&nbsp;* @retval =0ANone<BR>&nbsp;&nbsp;*/</FONT><BR><FONT col=
or=3D#0000ff><B>void</B></FONT> =0ABoard_PBInit(<FONT =0Acolor=3D=
#0000ff><B>void</B></FONT>)<BR>{<BR>&nbsp;&nbsp;GPIO_InitTypeDef=20=
=0AGPIO_InitStructure;<BR>&nbsp;&nbsp;<FONT color=3D#008000>/* En=
able the BUTTON =0AClock */</FONT><BR>&nbsp;&nbsp;RCC_AHB1PeriphC=
lockCmd(BUTTON_CLK[<FONT =0Acolor=3D#6e00aa>0</FONT>], ENABLE);<B=
R>&nbsp;&nbsp;<FONT =0Acolor=3D#008000>//RCC_APB2PeriphClockCmd(R=
CC_APB2Periph_SYSCFG, =0AENABLE);</FONT><BR>&nbsp;&nbsp;<FONT col=
or=3D#008000>/* Configure Button pin as =0Ainput */</FONT><BR>&nb=
sp;&nbsp;GPIO_InitStructure.GPIO_Mode <FONT =0Acolor=3D#333399>=3D=
</FONT> GPIO_Mode_IN;<BR>&nbsp;&nbsp;GPIO_InitStructure.GPIO_PuPd=
 =0A<FONT color=3D#333399>=3D</FONT> =0AGPIO_PuPd_UP;<BR>&nbsp;&n=
bsp;GPIO_InitStructure.GPIO_Pin <FONT =0Acolor=3D#333399>=3D</FON=
T> BUTTON_PIN[<FONT =0Acolor=3D#6e00aa>0</FONT>];<BR>&nbsp;&nbsp;=
<FONT =0Acolor=3D#008000>//GPIO_InitStructure.GPIO_Speed =3D =0AG=
PIO_Speed_100MHz;//100M</FONT><BR>&nbsp;&nbsp;GPIO_Init(BUTTON_PO=
RT[<FONT =0Acolor=3D#6e00aa>0</FONT>], <FONT =0Acolor=3D#333399>&=
amp;</FONT>GPIO_InitStructure);<BR>}<BR><FONT =0Acolor=3D#008000>=
/**<BR>&nbsp;&nbsp;* @brief&nbsp;&nbsp;Returns the selected Butto=
n =0Astate.<BR>&nbsp;&nbsp;* @param&nbsp;&nbsp;Button: Specifies=20=
the Button to be =0Achecked.<BR>&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;Th=
is parameter can be one of =0Afollowing =0Aparameters:&nbsp;&nbsp=
;&nbsp;&nbsp;<BR>&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@arg=20=
=0ABUTTON_KEY: Key Push Button&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;*=
 @retval The =0AButton GPIO pin value.<BR>&nbsp;&nbsp;*/</FONT><B=
R>uint32_t =0ABoard_PBGetState(<FONT =0Acolor=3D#0000ff><B>void</=
B></FONT>)<BR>{<BR>&nbsp;&nbsp;<FONT =0Acolor=3D#0000ff><B>return=
</B></FONT> GPIO_ReadInputDataBit(BUTTON_PORT[<FONT =0Acolor=3D#6=
e00aa>0</FONT>], BUTTON_PIN[<FONT color=3D#6e00aa>0</FONT>]);<BR>=
}</DIV>=0A<P class=3DMsoNormal =0Astyle=3D"MARGIN: 0cm 0cm 0pt; W=
ORD-SPACING: 0px; FONT: 12px/16px =CB=CE=CC=E5; TEXT-TRANSFORM: n=
one; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal; LE=
TTER-SPACING: normal; orphans: auto; widows: auto; webkit-text-st=
roke-width: 0px"><BR>=D5=E2=D2=BB=B2=BD=D0=DE=B8=C4=B2=A2=B2=BB=CA=
=C7=CC=AB=B4=F3=A1=A3=C8=BB=BA=F3=CE=D2=C3=C7=BE=CD=D0=E8=D2=AA=D0=
=DE=B8=C4 =0Amain=BA=AF=CA=FD=A3=BA<BR></P>=0A<DIV =0Astyle=3D"BO=
RDER-RIGHT: black 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: blac=
k 1px solid; PADDING-LEFT: 3px; FONT-SIZE: 12px; MARGIN-LEFT: aut=
o; BORDER-LEFT: black 1px solid; COLOR: black; MARGIN-RIGHT: auto=
; PADDING-TOP: 3px; BORDER-BOTTOM: black 1px solid; FONT-FAMILY:=20=
Courier New; BACKGROUND-COLOR: window; TEXT-ALIGN: left; 3px: "><=
FONT =0Acolor=3D#0000ff><B>int</B></FONT> main(<FONT =0Acolor=3D#=
0000ff><B>void</B></FONT>)<BR>{<BR>&nbsp;uint8_t down<FONT =0Acol=
or=3D#333399>=3D</FONT><FONT =0Acolor=3D#6e00aa>0</FONT>;<BR>&nbs=
p;&nbsp;uart_init(<FONT =0Acolor=3D#6e00aa>115200</FONT>);<BR>&nb=
sp;&nbsp;printf(<FONT =0Acolor=3D#ff00bf>"QiFreeUSBS version %s.%=
s.%s\r\n"</FONT>, VERSION, PATCHLEVEL, =0ASUBLEVEL);<BR>&nbsp;&nb=
sp;Board_LEDInit(LED1);<BR>&nbsp;&nbsp;Board_LEDInit(LED2);<BR>&n=
bsp;&nbsp;Board_PBInit();<BR>&nbsp;&nbsp;USBD_Init(<FONT =0Acolor=
=3D#333399>&amp;</FONT>USB_OTG_dev,<BR>#<FONT =0Acolor=3D#0000ff>=
<B>ifdef</B></FONT> =0AUSE_USB_OTG_HS&nbsp;<BR>&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USB_OTG_HS_=
CORE_ID,<BR>#<FONT =0Acolor=3D#0000ff><B>else</B></FONT>&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<B=
R>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;USB_OTG_FS_CORE_ID,<BR>#<FONT =0Acolor=3D#0000ff><B>endi=
f</B></FONT>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT =0Acolor=3D#333399>&amp;</FON=
T>USR_desc,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;<FONT =0Acolor=3D#333399>&amp;</FONT>USBD_M=
SC_cb,&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;<FONT =0Acolor=3D#333399>&amp;</FONT>USR_c=
b);<BR>&nbsp;<BR>&nbsp;<FONT =0Acolor=3D#0000ff><B>while</B></FON=
T> (<FONT =0Acolor=3D#6e00aa>1</FONT>)<BR>&nbsp;{<BR>&nbsp;&nbsp;=
Board_LEDToggle(LED1);<BR>&nbsp;&nbsp;Board_LEDToggle(LED2);<BR>&=
nbsp;&nbsp;down =0A<FONT color=3D#333399>=3D</FONT> Board_PBGetSt=
ate();<BR>&nbsp;&nbsp;<FONT =0Acolor=3D#008000>//down =3D (~down)=
&amp;0x1;</FONT><BR>&nbsp;&nbsp;<FONT =0Acolor=3D#008000>//printf=
("waitting ...\r\n");</FONT><BR>&nbsp;&nbsp;printf(<FONT =0Acolor=
=3D#ff00bf>"KEY:%d\r\n"</FONT>, down);<BR>&nbsp;&nbsp;delay_ms(<F=
ONT =0Acolor=3D#6e00aa>100</FONT>);&nbsp;&nbsp;&nbsp;<BR>&nbsp;}<=
BR>} </DIV>=0A<P class=3DMsoNormal =0Astyle=3D"MARGIN: 0cm 0cm 0p=
t; WORD-SPACING: 0px; FONT: 12px/16px =CB=CE=CC=E5; TEXT-TRANSFOR=
M: none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal=
; LETTER-SPACING: normal; orphans: auto; widows: auto; webkit-tex=
t-stroke-width: 0px"><BR>=D5=E2=C0=EF=D6=F7=D2=AA=CA=C7=CE=AA=C1=CB=
=C8=B7=B6=A8=B0=B4=BC=FC=B0=B4=CF=C2=B8=FA=B5=AF=C6=F0=B5=C4=D6=B5=
=A1=A3=CE=D2=B5=C4=BD=E1=B9=FB=CA=C7=B0=B4=BC=FC=B5=AF=C6=F0=CE=AA=
 =0A1=A3=AC=B0=B4=BC=FC=B0=B4=CF=C2=CE=AA 0=A1=A3=D2=F2=CE=AA=CE=D2=
=CF=D6=D4=DA=CA=C7=B2=E2=CA=D4=A3=AC=CE=AA=C1=CB=B2=E2=CA=D4=B7=BD=
=B1=E3=CE=D2=CF=A3=CD=FB=B0=B4=BC=FC=B0=B4=CF=C2=CA=B1=D2=FD=B5=BC=
 App=A3=AC=CB=F9=D2=D4=A3=BA<BR></P>=0A<DIV =0Astyle=3D"BORDER-RI=
GHT: black 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: black 1px s=
olid; PADDING-LEFT: 3px; FONT-SIZE: 12px; MARGIN-LEFT: auto; BORD=
ER-LEFT: black 1px solid; COLOR: black; MARGIN-RIGHT: auto; PADDI=
NG-TOP: 3px; BORDER-BOTTOM: black 1px solid; FONT-FAMILY: Courier=
 New; BACKGROUND-COLOR: window; TEXT-ALIGN: left; 3px: "><FONT =0A=
color=3D#0000ff><B>typedef</B></FONT>&nbsp;&nbsp;<FONT =0Acolor=3D=
#0000ff><B>void</B></FONT> (<FONT color=3D#333399>*</FONT>pFuncti=
on)(<FONT =0Acolor=3D#0000ff><B>void</B></FONT>);<BR><FONT color=3D=
#0000ff><B>static</B></FONT> =0ApFunction Jump_To_Application;<BR=
><FONT color=3D#0000ff><B>static</B></FONT> =0Auint32_t JumpAddre=
ss;<BR>#<FONT color=3D#0000ff><B>define</B></FONT> =0AAPP_DEFAULT=
_ADD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x08008000 =0A<FONT colo=
r=3D#008000>/* The first 2 sectores (32 KB) are reserved for DFU=20=
code =0A*/</FONT><BR><FONT color=3D#008000>/**<BR>&nbsp;&nbsp;* @=
brief&nbsp;&nbsp;Program =0Aentry point<BR>&nbsp;&nbsp;* @param&n=
bsp;&nbsp;None<BR>&nbsp;&nbsp;* @retval =0ANone<BR>&nbsp;&nbsp;*/=
</FONT><BR><FONT color=3D#0000ff><B>int</B></FONT> =0Amain(<FONT=20=
color=3D#0000ff><B>void</B></FONT>)<BR>{<BR>&nbsp;uint8_t down<FO=
NT =0Acolor=3D#333399>=3D</FONT><FONT color=3D#6e00aa>0</FONT>;<B=
R>&nbsp;&nbsp;<FONT =0Acolor=3D#008000>/*!&lt; At this stage the=20=
microcontroller clock setting is already =0Aconfigured,&nbsp;<BR>=
&nbsp;&nbsp;this is done through SystemInit() function =0Awhich i=
s called from startup<BR>&nbsp;&nbsp;file (startup_stm32fxxx_xx.s=
) before =0Ato branch to application main.<BR>&nbsp;&nbsp;To reco=
nfigure the default setting =0Aof SystemInit() function, refer to=
<BR>&nbsp;&nbsp;system_stm32fxxx.c =0Afile<BR>&nbsp;&nbsp;*/</FON=
T>&nbsp;<BR>&nbsp;&nbsp;uart_init(<FONT =0Acolor=3D#6e00aa>115200=
</FONT>);<BR>&nbsp;&nbsp;printf(<FONT =0Acolor=3D#ff00bf>"QiFreeU=
SBS version %s.%s.%s\r\n"</FONT>, VERSION, PATCHLEVEL, =0ASUBLEVE=
L);<BR>&nbsp;&nbsp;Board_LEDInit(LED1);<BR>&nbsp;&nbsp;Board_LEDI=
nit(LED2);<BR>&nbsp;&nbsp;Board_PBInit();<BR>&nbsp;&nbsp;<FONT =0A=
color=3D#0000ff><B>if</B></FONT> (Board_PBGetState() <FONT color=3D=
#333399>=3D=3D</FONT> =0A0x00)<BR>&nbsp;&nbsp;{ <FONT color=3D#00=
8000>/* Test if user code is programmed =0Astarting from address=20=
0x800C000 */</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT =0Acolor=3D#=
0000ff><B>if</B></FONT> (((<FONT color=3D#333399>*</FONT>(__IO =0A=
uint32_t<FONT color=3D#333399>*</FONT>)APP_DEFAULT_ADD) <FONT =0A=
color=3D#333399>&amp;</FONT> 0x2FFE0000 ) <FONT color=3D#333399>=3D=
=3D</FONT> =0A0x20000000)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <FONT colo=
r=3D#008000>/* Jump to user =0Aapplication */</FONT><BR>&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;JumpAddress <FONT =0Acolor=3D#333399>=3D=
</FONT> <FONT color=3D#333399>*</FONT>(__IO uint32_t<FONT =0Acolo=
r=3D#333399>*</FONT>) (APP_DEFAULT_ADD <FONT color=3D#333399>+</F=
ONT> <FONT =0Acolor=3D#6e00aa>4</FONT>);<BR>&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;Jump_To_Application =0A<FONT color=3D#333399>=3D</=
FONT> (pFunction) =0AJumpAddress;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;<FONT color=3D#008000>/* =0AInitialize user application's=
 Stack Pointer =0A*/</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;__set_MSP(<FONT =0Acolor=3D#333399>*</FONT>(__IO uint32_t<FONT=20=
color=3D#333399>*</FONT>) =0AAPP_DEFAULT_ADD);<BR>&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;Jump_To_Application();<BR>&nbsp;&nbsp;&nbsp;=
&nbsp;}<BR>&nbsp;&nbsp;} =0A<FONT color=3D#008000>/* Otherwise en=
ters DFU mode to allow user to program his =0Aapplication */</FON=
T></DIV>=0A<P class=3DMsoNormal =0Astyle=3D"MARGIN: 0cm 0cm 0pt;=20=
WORD-SPACING: 0px; FONT: 12px/16px =CB=CE=CC=E5; TEXT-TRANSFORM:=20=
none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal; L=
ETTER-SPACING: normal; orphans: auto; widows: auto; webkit-text-s=
troke-width: 0px"><BR>=CE=D2=C3=C7=BF=C9=D2=D4=D5=E2=D1=F9=CA=B5=CF=
=D6=D2=FD=B5=BC=B9=A6=C4=DC=A1=A3=B5=AB=CA=C7=D7=A2=D2=E2=A3=AC =0A=
ST=B5=C4 DFU=CA=C7=B0=D1=B9=CC=BC=FE=B7=C5=D4=DA <FONT color=3D#0=
08000>0x800C000 </FONT>=D5=E2=B8=F6=B5=D8=D6=B7=A3=AC=B5=AB=CE=D2=
=C3=C7=CA=C7=B0=D1=B9=CC=BC=FE=B7=C5=D4=DA <FONT =0Acolor=3D#0080=
00>0x8008000 </FONT>=D5=E2=B8=F6=B5=D8=D6=B7=A1=A3=CB=F9=D2=D4=CE=
=D2=C3=C7=CF=D6=D4=DA=D2=AA=BD=E2=BE=F6=B5=C4=CA=C7=D4=F5=C3=B4=B0=
=D1=CE=D2=C3=C7=B5=C4 App=B7=C5=D4=DA=D5=E2=B8=F6=B5=D8=D6=B7=C8=A5=
=A1=A3=D6=AE=C7=B0=CE=D2=C3=C7=D4=DA=D3=C3 =0AFlash=C0=A9=D5=B9=B4=
=C5=C5=CC=B5=C4=CA=B1=BA=F2=C8=B7=CA=B5=D2=B2=CA=C7=B4=D3 Flash=B5=
=C4 0X08008000=B5=D8=D6=B7=BF=AA=CA=BC=B4=E6=B7=C5=CA=FD=BE=DD=A3=
=AC=B5=AB=B5=B1=CA=B1=CE=D2=C3=C7=CA=C7=B0=D1 32K=B5=C4=CA=FD=BE=DD=
=B7=C5=D4=DA =0ASRAM=D6=D0=A3=AC=BF=C9=CE=CA=CC=E2=CA=C7=CE=D2=C3=
=C7=D4=DA=B0=D1=B9=CC=BC=FE=CD=F9=C9=E8=B1=B8=D6=D0=BF=BD=B1=B4=B5=
=C4=CA=B1=BA=F2 32K=D5=E2=B8=F6=CE=BB=D6=C3=B8=D5=BA=C3=CA=C7=CE=D2=
=C3=C7=B5=C4=B9=CC=BC=FE=C2=F0=A3=BF=D5=E2=B8=F6=CE=D2=C3=C7=BF=C9=
=D2=D4=CD=A8=B9=FD=B4=AE=BF=DA=CA=E4=B3=F6=CF=C2=D4=D8=B9=CC=BC=FE=
=CA=B1=CB=F9=B2=D9=D7=F7=B5=C4=B5=D8=D6=B7=A3=AC=D6=A4=C3=F7=B2=BB=
=CA=C7 32K=A3=AC =0Axp=CF=B5=CD=B3=CA=C7 20K(<STRONG>F103</STRONG=
>)=A3=AC=B6=F8=C7=D2=B2=BB=CD=AC=B5=C4=CF=B5=CD=B3=B2=A2=B2=BB=CD=
=EA=C8=AB=D2=BB=D1=F9=A1=A3=CB=F9=D2=D4=CE=D2=C3=C7=D0=E8=D2=AA=D2=
=BB=D6=D6=B7=BD=CA=BD=C8=B7=B6=A8=D5=E2=B8=F6=B5=D8=D6=B7=A3=AC=CE=
=D2=B3=C6=D6=AE=CE=AA =0AOffset=A1=A3=D2=B2=D5=FD=CA=C7=D3=C9=D3=DA=
=D5=E2=B8=F6=D4=AD=D2=F2=CE=D2=C3=C7=B2=BB=C4=DC=D6=B1=BD=D3=CA=B9=
=D3=C3 *.bin=B8=F1=CA=BD=B5=C4=B9=CC=BC=FE=A3=AC=B6=F8=B1=D8=D0=EB=
=CA=B9=D3=C3 *.mac=B8=F1=CA=BD=B5=C4=B9=CC=BC=FE=A1=A3=C8=E7=B9=FB=
=C4=E3=BF=B4=B9=FD=CE=D2=D6=AE=C7=B0=D0=B4=B5=C4 USBS=B5=C4=CA=B9=
=D3=C3=BD=CC=B3=CC=C4=E3=D3=A6=B8=C3=D6=AA=B5=C0 =0A*.mac=CE=C4=BC=
=FE=CA=C7=CE=D2=D7=D4=B6=A8=D2=E5=B5=C4=D2=BB=D6=D6=CE=C4=BC=FE=B8=
=F1=CA=BD=A3=AC=D3=C9=D3=DA=D7=EE=B3=F5=D4=DA F103=C9=CF=CE=AA=C1=
=CB=BD=E2=BE=F6=C6=BB=B9=FB=B5=E7=C4=D4=B5=C4=C9=FD=BC=B6=B6=F8=C9=
=E8=BC=C6=B5=C4=B9=CA=C3=FB =0A*.mac=A1=A3=C6=E4=CA=B5=BE=CD=CA=C7=
=D4=DA=B9=CC=BC=FE=B5=C4=C7=B0=C3=E6=D4=F6=BC=D3=D2=BB=B6=CE=CA=B6=
=B1=F0=D0=C5=CF=A2(1K)=D3=C3=D3=DA=C8=B7=B6=A8=B9=CC=BC=FE=B5=C4=20=
Offset=A1=A3=D4=DA USBS=B5=C4=C5=E4=D6=C3=C8=ED=BC=FE=D6=D0=D3=D0=
=D2=BB=B8=F6 QiFreeOS.exe=B5=C4=B3=CC=D0=F2=BF=C9=D2=D4=BD=AB =0A=
*.bin=CE=C4=BC=FE=D7=AA=B3=C9&nbsp; *.mac=CE=C4=BC=FE=A3=AC=D3=C3=
=B9=FD=B5=C4=CE=D2=CF=EB=B6=BC=D6=AA=B5=C0=A1=A3<BR><BR>&nbsp;&nb=
sp;&nbsp; <STRONG><SPAN =0Aid=3Dwiz_font_size_span_4880640 =0Asty=
le=3D"FONT-SIZE: 16pt"><STRONG>=C4=C7</STRONG></SPAN></STRONG>=C3=
=B4=CE=D2=C3=C7=BE=CD=D0=E8=D2=AA=D4=DA =0Ausbd_storage_msd.c=D4=B4=
=CE=C4=BC=FE=D6=D0=CC=ED=BC=D3=C8=E7=CF=C2=B4=FA=C2=EB=A3=BA<BR><=
/P>=0A<DIV =0Astyle=3D"BORDER-RIGHT: black 1px solid; PADDING-RIG=
HT: 3px; BORDER-TOP: black 1px solid; PADDING-LEFT: 3px; FONT-SIZ=
E: 12px; MARGIN-LEFT: auto; BORDER-LEFT: black 1px solid; COLOR:=20=
black; MARGIN-RIGHT: auto; PADDING-TOP: 3px; BORDER-BOTTOM: black=
 1px solid; FONT-FAMILY: Courier New; BACKGROUND-COLOR: window; T=
EXT-ALIGN: left; 3px: "><FONT =0Acolor=3D#008000>//=B9=CA=CF=E7=B5=
=C4=D4=AD=B7=E7=BE=B0=BC=F2=C6=D7=C7=B0=B0=EB=B6=CE</FONT><BR><FO=
NT color=3D#0000ff><B>static</B></FONT> =0A<FONT color=3D#0000ff>=
<B>const</B></FONT> <FONT color=3D#0000ff><B>char</B></FONT> =0AS=
ojiro[]<FONT color=3D#333399>=3D</FONT><FONT color=3D#ff00bf>"Soj=
iro 1=3DF 4/4 =0A||5612-|2-3216|3--5612|2---|321553|3-5612|2---|3=
2163-|3-5612|2---|32166-|6--0|"</FONT>;<BR><FONT =0Acolor=3D#0080=
00>//const char Description[]=3D"\</FONT><BR><FONT color=3D#00800=
0>//* =0AAuthor&nbsp;&nbsp;&nbsp;: merafour.blog.163.com\r\n\</FO=
NT><BR><FONT =0Acolor=3D#008000>////* Version&nbsp;&nbsp;: V1.0.0=
\r\n\</FONT><BR><FONT =0Acolor=3D#008000>//* Date&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;: =0A2/26/2015\r\n";</FONT><BR><FONT color=3D#0000f=
f><B>static</B></FONT> <FONT =0Acolor=3D#0000ff><B>void</B></FONT=
> check_Sojiro(<FONT =0Acolor=3D#0000ff><B>const</B></FONT> uint3=
2_t Memory_Offset, <FONT =0Acolor=3D#0000ff><B>const</B></FONT> <=
FONT color=3D#0000ff><B>char</B></FONT> <FONT =0Acolor=3D#333399>=
*</FONT>Writebuff, <FONT color=3D#0000ff><B>const</B></FONT> =0Au=
int16_t Transfer_Length)<BR>{<BR>&nbsp;uint16_t Sojiro_len <FONT=20=
=0Acolor=3D#333399>=3D</FONT> strlen(Sojiro);<BR>&nbsp;<FONT colo=
r=3D#008000>//char =0Abuf[1024]=3D{0}; // 1K</FONT><BR>&nbsp;<FON=
T color=3D#008000>//uint32_t offsst =3D =0A0;</FONT><BR>&nbsp;<FO=
NT color=3D#008000>//dprintf("Sojiro: %8d | %8d\r\n", =0ASojiro_l=
en, Transfer_Length);</FONT><BR>&nbsp;<FONT =0Acolor=3D#0000ff><B=
>if</B></FONT>(Sojiro_len<FONT color=3D#333399>&lt;</FONT><FONT =0A=
color=3D#333399>=3D</FONT>Transfer_Length) <FONT color=3D#008000>=
// check =0Alength</FONT><BR>&nbsp;{<BR>&nbsp;&nbsp;<FONT color=3D=
#008000>//dprintf("check: =0A%s\r\n", Writebuff);</FONT><BR>&nbsp=
;&nbsp;<FONT color=3D#008000>// =0Amatch</FONT><BR>&nbsp;&nbsp;<F=
ONT color=3D#008000>//if(0=3D=3Dstrncmp(Sojiro, =0A(char*)Writebu=
ff, Sojiro_len)) // =C6=A5=C5=E4=B3=C9=B9=A6</FONT><BR>&nbsp;&nbs=
p;<FONT =0Acolor=3D#0000ff><B>if</B></FONT>(<FONT color=3D#6e00aa=
>0</FONT><FONT =0Acolor=3D#333399>=3D=3D</FONT>strncmp(Sojiro, Wr=
itebuff, Sojiro_len)) <FONT =0Acolor=3D#008000>// =C6=A5=C5=E4=B3=
=C9=B9=A6</FONT><BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;<FONT =0Ac=
olor=3D#008000>//dprintf("match OK!\r\n");</FONT><BR>&nbsp;&nbsp;=
&nbsp;<FONT =0Acolor=3D#008000>//dprintf("Memory_Offset: %08X\r\n=
", =0AMemory_Offset);</FONT><BR>&nbsp;&nbsp;&nbsp;<FONT color=3D#=
008000>// =0ARAM_FAT32_Offset move to bin</FONT><BR>&nbsp;&nbsp;&=
nbsp;<FONT =0Acolor=3D#008000>/**<BR>&nbsp;&nbsp;&nbsp;&nbsp;*&nb=
sp;&nbsp;RAM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;RAM<BR>&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;|------=
-|0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|--------|0<BR>&nbsp;&nbsp=
;&nbsp;&nbsp;*&nbsp;&nbsp;|-FAT =0A--|FAT32&nbsp;&nbsp;|-FAT----|=
FAT32<BR>&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;|&nbsp;&nbsp;...&nb=
sp;&nbsp;|move&nbsp;&nbsp;&nbsp;|--------|Offsst<BR>&nbsp;&nbsp;&=
nbsp;&nbsp;*&nbsp;&nbsp;|-empty-|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;|&nbsp;&nbsp;Flash =0A|<BR>&nbsp;&nbsp;&nbsp;&nbsp;*&nb=
sp;&nbsp;|-------|Offsst =0A|&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;|<B=
R>&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|--------|<BR>&nb=
sp;&nbsp;&nbsp;&nbsp;*/</FONT><BR>&nbsp;&nbsp;&nbsp;RAM_FAT32_Off=
set =0A<FONT color=3D#333399>=3D</FONT> Memory_Offset<FONT color=3D=
#333399>+</FONT><FONT =0Acolor=3D#6e00aa>1024</FONT>; <FONT color=
=3D#008000>// =0A1K</FONT><BR>&nbsp;&nbsp;&nbsp;printf(<FONT colo=
r=3D#ff00bf>"RAM_FAT32_Offset: =0A%08X\r\n"</FONT>, RAM_FAT32_Off=
set);<BR>&nbsp;&nbsp;}<BR>&nbsp;}<BR>}</DIV>=0A<P class=3DMsoNorm=
al =0Astyle=3D"MARGIN: 0cm 0cm 0pt; WORD-SPACING: 0px; FONT: 12px=
/16px =CB=CE=CC=E5; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0); TEXT=
-INDENT: 0px; WHITE-SPACE: normal; LETTER-SPACING: normal; orphan=
s: auto; widows: auto; webkit-text-stroke-width: 0px"><BR>=C8=BB=BA=
=F3=CE=D2=C3=C7=D4=DA=D0=DE=B8=C4 =0ASTORAGE_Write=BA=AF=CA=FD=A3=
=BA<BR></P>=0A<DIV =0Astyle=3D"BORDER-RIGHT: black 1px solid; PAD=
DING-RIGHT: 3px; BORDER-TOP: black 1px solid; PADDING-LEFT: 3px;=20=
FONT-SIZE: 12px; MARGIN-LEFT: auto; BORDER-LEFT: black 1px solid;=
 COLOR: black; MARGIN-RIGHT: auto; PADDING-TOP: 3px; BORDER-BOTTO=
M: black 1px solid; FONT-FAMILY: Courier New; BACKGROUND-COLOR: w=
indow; TEXT-ALIGN: left; 3px: ">int8_t =0ASTORAGE_Write (uint8_t=20=
=0Alun,&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint8=
_t =0A<FONT =0Acolor=3D#333399>*</FONT>buf,&nbsp;<BR>&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint32_t =0Ablk_addr,<BR>&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint16_t =0Ablk_len)<BR>{<BR>&n=
bsp;int8_t ret <FONT color=3D#333399>=3D</FONT> <FONT =0Acolor=3D=
#6e00aa>0</FONT>;&nbsp;<BR>&nbsp;uint32_t Memory_Offset <FONT =0A=
color=3D#333399>=3D</FONT> blk_addr<FONT color=3D#333399>*</FONT>=
<FONT =0Acolor=3D#6e00aa>512</FONT>;<BR>&nbsp;<FONT color=3D#0080=
00>//printf("@%s [%d]addr: =0A%03dK | %04d\r\n", __func__, lun, (=
blk_addr*512)/1024, =0Ablk_len*512);</FONT><BR>&nbsp;check_Sojiro=
(Memory_Offset, (<FONT =0Acolor=3D#0000ff><B>char</B></FONT><FONT=
 color=3D#333399>*</FONT>)buf, blk_len<FONT =0Acolor=3D#333399>*<=
/FONT><FONT color=3D#6e00aa>512</FONT>);<BR>&nbsp;<FONT =0Acolor=3D=
#0000ff><B>if</B></FONT>(RAM_FAT32_Offset<FONT =0Acolor=3D#333399=
>&gt;</FONT>Memory_Offset) <FONT color=3D#008000>// FAT32 =3D=3D&=
gt; =0ASRAM</FONT><BR>&nbsp;{<BR>&nbsp;&nbsp;ret<FONT =0Acolor=3D=
#333399>=3D</FONT>SRAM_Write(buf, blk_addr<FONT color=3D#333399>*=
</FONT><FONT =0Acolor=3D#6e00aa>512</FONT>, blk_len<FONT color=3D=
#333399>*</FONT><FONT =0Acolor=3D#6e00aa>512</FONT>);<BR>&nbsp;}<=
BR>&nbsp;<FONT =0Acolor=3D#0000ff><B>else</B></FONT><BR>&nbsp;{<B=
R>&nbsp;&nbsp;Memory_Offset <FONT =0Acolor=3D#333399>-=3D</FONT>=20=
(uint32_t)RAM_FAT32_Offset;<BR>&nbsp;&nbsp;ret<FONT =0Acolor=3D#3=
33399>=3D</FONT>Flash_Write(FLASH_SAVE_ADDR<FONT =0Acolor=3D#3333=
99>+</FONT>Memory_Offset,(u32<FONT color=3D#333399>*</FONT>)buf,=20=
=0A(blk_len<FONT color=3D#333399>*</FONT><FONT color=3D#6e00aa>51=
2</FONT>)<FONT =0Acolor=3D#333399>/</FONT><FONT color=3D#6e00aa>4=
</FONT>);<BR>&nbsp;}<BR>&nbsp;<FONT =0Acolor=3D#0000ff><B>return<=
/B></FONT> ret;<BR>}</DIV>=0A<P class=3DMsoNormal =0Astyle=3D"MAR=
GIN: 0cm 0cm 0pt; WORD-SPACING: 0px; FONT: 12px/16px =CB=CE=CC=E5=
; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; WHIT=
E-SPACE: normal; LETTER-SPACING: normal; orphans: auto; widows: a=
uto; webkit-text-stroke-width: 0px"><BR>=D2=B2=BE=CD=CA=C7=CB=B5=C3=
=BF=D2=BB=B4=CE =0AWrite=B2=D9=D7=F7=CE=D2=B6=BC=BB=A5=C6=A5=C5=E4=
=D0=C5=CF=A2=A3=AC=C8=E7=B9=FB=CA=C7=CE=D2=C3=C7 *.mac=CE=C4=BC=FE=
=B5=C4=B1=EA=CA=B6=CE=D2=C3=C7=BE=CD=D6=D8=D0=C2=C9=E8=D6=C3 RAM_=
FAT32_Offset=B5=C4=B4=F3=D0=A1=A1=A3=CB=F9=D2=D4=CF=D6=D4=DA =0Ab=
ootloader=CA=C7=CD=EA=B3=C9=C1=CB=A3=AC=CE=D2=C3=C7=BB=B9=D0=E8=D2=
=AA=D2=BB=B8=F6 App=BD=F8=D0=D0=B2=E2=CA=D4=A1=A3=D5=E2=B8=F6=CE=D2=
=C3=C7=BF=C9=D2=D4=BD=AB =0AUSBS_V0.5.21=B5=C4=D4=B4=C2=EB=BF=BD=B1=
=B4=D2=BB=B7=DD=A3=AC=B2=A2=C3=FC=C3=FB=CE=AA=A3=BAUSBS_App_Test=A1=
=A3=C8=BB=BA=F3=B4=F2=BF=AA=B9=A4=B3=CC=D0=DE=B8=C4=C6=E4 main=BA=
=AF=CA=FD=A3=BA<BR></P>=0A<DIV =0Astyle=3D"BORDER-RIGHT: black 1p=
x solid; PADDING-RIGHT: 3px; BORDER-TOP: black 1px solid; PADDING=
-LEFT: 3px; FONT-SIZE: 12px; MARGIN-LEFT: auto; BORDER-LEFT: blac=
k 1px solid; COLOR: black; MARGIN-RIGHT: auto; PADDING-TOP: 3px;=20=
BORDER-BOTTOM: black 1px solid; FONT-FAMILY: Courier New; BACKGRO=
UND-COLOR: window; TEXT-ALIGN: left; 3px: ">#<FONT =0Acolor=3D#00=
00ff><B>define</B></FONT> VectorsOffset 0x8000<BR><FONT =0Acolor=3D=
#0000ff><B>int</B></FONT> main(<FONT =0Acolor=3D#0000ff><B>void</=
B></FONT>)<BR>{<BR>&nbsp;&nbsp;<FONT =0Acolor=3D#008000>/*!&lt; A=
t this stage the microcontroller clock setting is already =0Aconf=
igured,&nbsp;<BR>&nbsp;&nbsp;this is done through SystemInit() fu=
nction =0Awhich is called from startup<BR>&nbsp;&nbsp;file (start=
up_stm32fxxx_xx.s) before =0Ato branch to application main.<BR>&n=
bsp;&nbsp;To reconfigure the default setting =0Aof SystemInit() f=
unction, refer to<BR>&nbsp;&nbsp;system_stm32fxxx.c =0Afile<BR>&n=
bsp;&nbsp;*/</FONT>&nbsp;<BR>&nbsp;NVIC_SetVectorTable(NVIC_VectT=
ab_FLASH, =0AVectorsOffset); <FONT color=3D#008000>// =0A&amp;__V=
ectors</FONT><BR>&nbsp;&nbsp;uart_init(<FONT =0Acolor=3D#6e00aa>1=
15200</FONT>);<BR>&nbsp;&nbsp;printf(<FONT =0Acolor=3D#ff00bf>"Qi=
FreeUSBS App Test %s.%s.%s\r\n"</FONT>, VERSION, PATCHLEVEL, =0AS=
UBLEVEL);<BR>&nbsp;&nbsp;Board_LEDInit(LED1);<BR>&nbsp;&nbsp;Boar=
d_LEDInit(LED2);<BR>&nbsp;&nbsp;delay_ms(<FONT =0Acolor=3D#6e00aa=
>200</FONT>);<BR>&nbsp;&nbsp;USBD_Init(<FONT =0Acolor=3D#333399>&=
amp;</FONT>USB_OTG_dev,<BR>#<FONT =0Acolor=3D#0000ff><B>ifdef</B>=
</FONT> =0AUSE_USB_OTG_HS&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USB_OTG_HS_CORE_ID,<BR>=
#<FONT =0Acolor=3D#0000ff><B>else</B></FONT>&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USB=
_OTG_FS_CORE_ID,<BR>#<FONT =0Acolor=3D#0000ff><B>endif</B></FONT>=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;<FONT =0Acolor=3D#333399>&amp;</FONT>USR_desc,<=
BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;<FONT =0Acolor=3D#333399>&amp;</FONT>USBD_MSC_cb,&nbsp;=
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;<FONT =0Acolor=3D#333399>&amp;</FONT>USR_cb);<BR>&nbsp=
;&nbsp;<FONT =0Acolor=3D#0000ff><B>while</B></FONT> (<FONT =0Acol=
or=3D#6e00aa>1</FONT>)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;Board_LEDToggle(LED1);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;Board_LEDToggle(LED2);<BR>&nbsp;&nbsp;&nbsp;printf(<FO=
NT =0Acolor=3D#ff00bf>"App Test =0A...\r\n"</FONT>);<BR>&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;delay_ms(<FONT =0Acolor=3D#6e00aa>500<=
/FONT>);&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;}<BR>} </DIV>=0A<P clas=
s=3DMsoNormal =0Astyle=3D"MARGIN: 0cm 0cm 0pt; WORD-SPACING: 0px;=
 FONT: 12px/16px =CB=CE=CC=E5; TEXT-TRANSFORM: none; COLOR: rgb(0=
,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal; LETTER-SPACING: nor=
mal; orphans: auto; widows: auto; webkit-text-stroke-width: 0px">=
<BR>=CE=D2=C3=C7=BB=B9=D2=AA=BD=AB =0Ausb_bsp.c=D4=B4=CE=C4=BC=FE=
=D6=D0=B5=C4 USB_OTG_BSP_Init=B8=FA USB_OTG_BSP_EnableInterrupt=BA=
=AF=CA=FD=B8=C4=CE=AA=A3=BA<BR></P>=0A<DIV =0Astyle=3D"BORDER-RIG=
HT: black 1px solid; PADDING-RIGHT: 3px; BORDER-TOP: black 1px so=
lid; PADDING-LEFT: 3px; FONT-SIZE: 12px; MARGIN-LEFT: auto; BORDE=
R-LEFT: black 1px solid; COLOR: black; MARGIN-RIGHT: auto; PADDIN=
G-TOP: 3px; BORDER-BOTTOM: black 1px solid; FONT-FAMILY: Courier=20=
New; BACKGROUND-COLOR: window; TEXT-ALIGN: left; 3px: "><FONT =0A=
color=3D#0000ff><B>void</B></FONT> USB_OTG_BSP_Init(USB_OTG_CORE_=
HANDLE <FONT =0Acolor=3D#333399>*</FONT>pdev)<BR>{&nbsp;<BR>&nbsp=
;&nbsp;GPIO_InitTypeDef =0AGPIO_InitStructure;&nbsp;&nbsp;&nbsp;<=
BR>&nbsp;&nbsp;RCC_AHB1PeriphClockCmd( =0ARCC_AHB1Periph_GPIOA ,=20=
ENABLE);&nbsp;&nbsp;<BR>&nbsp;&nbsp;<FONT =0Acolor=3D#008000>/* C=
onfigure SOF ID DM DP Pins =0A*/</FONT><BR>&nbsp;&nbsp;GPIO_InitS=
tructure.GPIO_Pin <FONT =0Acolor=3D#333399>=3D</FONT> GPIO_Pin_11=
 <FONT =0Acolor=3D#333399>|</FONT>&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GPIO_Pin_12;<BR>&nbsp;&n=
bsp;GPIO_InitStructure.GPIO_Speed =0A<FONT color=3D#333399>=3D</F=
ONT> =0AGPIO_Speed_100MHz;<BR>&nbsp;&nbsp;GPIO_InitStructure.GPIO=
_Mode <FONT =0Acolor=3D#333399>=3D</FONT> =0AGPIO_Mode_AF;<BR>&nb=
sp;&nbsp;GPIO_InitStructure.GPIO_OType <FONT =0Acolor=3D#333399>=3D=
</FONT> =0AGPIO_OType_PP;<BR>&nbsp;&nbsp;GPIO_InitStructure.GPIO_=
PuPd <FONT =0Acolor=3D#333399>=3D</FONT> GPIO_PuPd_NOPULL ;<BR>&n=
bsp;&nbsp;GPIO_Init(GPIOA, <FONT =0Acolor=3D#333399>&amp;</FONT>G=
PIO_InitStructure);&nbsp;&nbsp;<BR>&nbsp;&nbsp;GPIO_PinAFConfig(G=
PIOA,GPIO_PinSource11,GPIO_AF_OTG1_FS) =0A;&nbsp;<BR>&nbsp;&nbsp;=
GPIO_PinAFConfig(GPIOA,GPIO_PinSource12,GPIO_AF_OTG1_FS) =0A;<BR>=
&nbsp;&nbsp;RCC_APB2PeriphClockCmd(RCC_APB2Periph_SYSCFG, =0AENAB=
LE);<BR>&nbsp;&nbsp;RCC_AHB2PeriphClockCmd(RCC_AHB2Periph_OTG_FS,=
 ENABLE) =0A;&nbsp;<BR>}<BR><FONT color=3D#0000ff><B>void</B></FO=
NT> =0AUSB_OTG_BSP_EnableInterrupt(USB_OTG_CORE_HANDLE <FONT =0Ac=
olor=3D#333399>*</FONT>pdev)<BR>{<BR>&nbsp;&nbsp;NVIC_InitTypeDef=
 =0ANVIC_InitStructure;&nbsp;<BR>&nbsp;&nbsp;NVIC_PriorityGroupCo=
nfig(NVIC_PriorityGroup_1);<BR>&nbsp;&nbsp;NVIC_InitStructure.NVI=
C_IRQChannel =0A<FONT color=3D#333399>=3D</FONT> =0AOTG_FS_IRQn;&=
nbsp;&nbsp;<BR>&nbsp;&nbsp;NVIC_InitStructure.NVIC_IRQChannelPree=
mptionPriority =0A<FONT color=3D#333399>=3D</FONT> <FONT =0Acolor=
=3D#6e00aa>1</FONT>;<BR>&nbsp;&nbsp;NVIC_InitStructure.NVIC_IRQCh=
annelSubPriority =0A<FONT color=3D#333399>=3D</FONT> <FONT =0Acol=
or=3D#6e00aa>3</FONT>;<BR>&nbsp;&nbsp;NVIC_InitStructure.NVIC_IRQ=
ChannelCmd =0A<FONT color=3D#333399>=3D</FONT> ENABLE;<BR>&nbsp;&=
nbsp;NVIC_Init(<FONT =0Acolor=3D#333399>&amp;</FONT>NVIC_InitStru=
cture);&nbsp;&nbsp;<BR>}</DIV>=0A<P class=3DMsoNormal =0Astyle=3D=
"MARGIN: 0cm 0cm 0pt; WORD-SPACING: 0px; FONT: 12px/16px =CB=CE=CC=
=E5; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; W=
HITE-SPACE: normal; LETTER-SPACING: normal; orphans: auto; widows=
: auto; webkit-text-stroke-width: 0px"><BR>=D2=F2=CE=AA=D6=AE=C7=B0=
=CE=D2=C3=C7=B2=A2=C3=BB=D3=D0=D0=DE=B8=C4=D5=E2=C1=BD=B8=F6=BA=AF=
=CA=FD=A3=AC=B6=F8=D5=E2=C0=EF=D4=AD=C0=B4=B5=C4=B4=FA=C2=EB=CA=B9=
=D3=C3=C1=CB =0APA9=A1=A2PA10=A3=AC=CE=D2=C3=C7=D2=AA=B0=D1=D5=E2=
=B2=BF=B7=D6=B4=FA=C2=EB=C8=A5=B5=F4=A3=AC=D2=F2=CE=AA=CE=D2=C3=C7=
=CA=C7=D7=F7=CE=AA=B4=AE=BF=DA=CA=B9=D3=C3=B5=C4=A1=A3=C8=BB=BA=F3=
=CE=D2=C3=C7=B4=F2=BF=AA=B9=A4=B3=CC=B5=C4=C5=E4=D6=C3=D1=A1=CF=EE=
=BD=AB Target=D6=D0=B5=C4&nbsp;ROM=C6=F0=CA=BC=B5=D8=D6=B7=D0=DE=B8=
=C4=CE=AA=A3=BA =0A0x8008000=A3=AC=BD=AB Output=D6=D0=CE=C4=BC=FE=
=C3=FB=B8=C4=CE=AA=A3=BAUSBS_F4_App=A3=AC=D4=D9=D4=DA User=D6=D0=CC=
=ED=BC=D3=D2=BB=B8=F6 Run=B2=A2=B9=B4=D1=A1=A3=AC=C6=E4=C4=DA=C8=DD=
=CE=AA=A3=BA<BR></P>=0A<DIV =0Astyle=3D"BORDER-RIGHT: black 1px s=
olid; PADDING-RIGHT: 3px; BORDER-TOP: black 1px solid; PADDING-LE=
FT: 3px; FONT-SIZE: 12px; MARGIN-LEFT: auto; BORDER-LEFT: black 1=
px solid; COLOR: black; MARGIN-RIGHT: auto; PADDING-TOP: 3px; BOR=
DER-BOTTOM: black 1px solid; FONT-FAMILY: Courier New; BACKGROUND=
-COLOR: window; TEXT-ALIGN: left; 3px: ">fromelf =0A<FONT color=3D=
#333399>--</FONT>bin <FONT =0Acolor=3D#ff00bf>"STM324xG-EVAL\USBS=
_F4_App.axf"</FONT> <FONT =0Acolor=3D#333399>--</FONT>output <FON=
T =0Acolor=3D#ff00bf>"STM324xG-EVAL\USBS_F4_App.bin"</FONT></DIV>=
=0A<P class=3DMsoNormal =0Astyle=3D"MARGIN: 0cm 0cm 0pt; WORD-SPA=
CING: 0px; FONT: 12px/16px =CB=CE=CC=E5; TEXT-TRANSFORM: none; CO=
LOR: rgb(0,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal; LETTER-SP=
ACING: normal; orphans: auto; widows: auto; webkit-text-stroke-wi=
dth: 0px"><BR>=D5=E2=CA=C7=D3=C3=C0=B4=BB=F1=B5=C3 =0Abin=CE=C4=BC=
=FE=B5=C4=A1=A3=C5=E4=D6=C3=BA=C3=C1=CB=D6=AE=BA=F3=CE=D2=C3=C7=B5=
=E3=BB=F7 build=B2=A2=BD=AB bin=CE=C4=BC=FE=D7=AA=B3=C9 =0Amac=CE=
=C4=BC=FE=D4=D9=BD=AB=C6=E4=BF=BD=B1=B4=B5=BD=B0=E5=D7=D3=C0=EF=B1=
=DF=A1=A3=C8=BB=BA=F3=CE=D2=C3=C7=B0=B4=D7=A1=B0=B4=BC=FC=B2=A2=BD=
=AB=B0=E5=D7=D3=B8=B4=CE=BB=A3=AC=CD=A8=B9=FD=B4=AE=BF=DA=CE=D2=C3=
=C7=BF=B4=B5=BD=D6=BB=CA=E4=B3=F6=C1=CB=A3=BA<BR></P>=0A<DIV =0As=
tyle=3D"BORDER-RIGHT: black 1px solid; PADDING-RIGHT: 3px; BORDER=
-TOP: black 1px solid; PADDING-LEFT: 3px; FONT-SIZE: 12px; MARGIN=
-LEFT: auto; BORDER-LEFT: black 1px solid; COLOR: black; MARGIN-R=
IGHT: auto; PADDING-TOP: 3px; BORDER-BOTTOM: black 1px solid; FON=
T-FAMILY: Courier New; BACKGROUND-COLOR: window; TEXT-ALIGN: left=
; 3px: ">QiFreeUSBS =0Aversion <FONT color=3D#6e00aa>1</FONT>.<FO=
NT color=3D#6e00aa>24</FONT>.<FONT =0Acolor=3D#6e00aa>8</FONT></D=
IV>=0A<P class=3DMsoNormal =0Astyle=3D"MARGIN: 0cm 0cm 0pt; WORD-=
SPACING: 0px; FONT: 12px/16px =CB=CE=CC=E5; TEXT-TRANSFORM: none;=
 COLOR: rgb(0,0,0); TEXT-INDENT: 0px; WHITE-SPACE: normal; LETTER=
-SPACING: normal; orphans: auto; widows: auto; webkit-text-stroke=
-width: 0px"><BR>=D2=B2=BE=CD=CA=C7=CB=B5 =0AApp=C3=BB=D3=D0=D4=CB=
=D0=D0=C6=F0=C0=B4=A3=AC=D2=F2=CE=AA App=D4=CB=D0=D0=C6=F0=C0=B4=D6=
=AE=BA=F3=BD=AB=CD=A8=B9=FD=B4=AE=BF=DA=CA=E4=B3=F6=D0=C5=CF=A2=A3=
=AC=B2=A2=B9=D2=D4=D8=D2=BB=B8=F6=B4=C5=C5=CC=A1=A3<BR><BR>&nbsp;=
&nbsp;&nbsp; =C6=E4=CA=B5=CE=D2=C3=C7=D0=E8=D2=AA=D0=DE=B8=C4 =0A=
USBS=D6=D0=B4=AE=BF=DA=B3=F5=CA=BC=BB=AF=B5=C4=CA=B1=BC=E4=B5=E3=A3=
=AC=BD=AB main=BA=AF=CA=FD=B8=C4=CE=AA=A3=BA<BR></P>=0A<DIV =0Ast=
yle=3D"BORDER-RIGHT: black 1px solid; PADDING-RIGHT: 3px; BORDER-=
TOP: black 1px solid; PADDING-LEFT: 3px; FONT-SIZE: 12px; MARGIN-=
LEFT: auto; BORDER-LEFT: black 1px solid; COLOR: black; MARGIN-RI=
GHT: auto; PADDING-TOP: 3px; BORDER-BOTTOM: black 1px solid; FONT=
-FAMILY: Courier New; BACKGROUND-COLOR: window; TEXT-ALIGN: left;=
 3px: "><FONT =0Acolor=3D#0000ff><B>int</B></FONT> main(<FONT =0A=
color=3D#0000ff><B>void</B></FONT>)<BR>{<BR>&nbsp;uint8_t down<FO=
NT =0Acolor=3D#333399>=3D</FONT><FONT color=3D#6e00aa>0</FONT>;<B=
R>&nbsp;&nbsp;<FONT =0Acolor=3D#008000>/*!&lt; At this stage the=20=
microcontroller clock setting is already =0Aconfigured,&nbsp;<BR>=
&nbsp;&nbsp;this is done through SystemInit() function =0Awhich i=
s called from startup<BR>&nbsp;&nbsp;file (startup_stm32fxxx_xx.s=
) before =0Ato branch to application main.<BR>&nbsp;&nbsp;To reco=
nfigure the default setting =0Aof SystemInit() function, refer to=
<BR>&nbsp;&nbsp;system_stm32fxxx.c =0Afile<BR>&nbsp;&nbsp;*/</FON=
T>&nbsp;<BR>&nbsp;&nbsp;<FONT =0Acolor=3D#008000>//uart_init(1152=
00);</FONT><BR>&nbsp;&nbsp;<FONT =0Acolor=3D#008000>//printf("QiF=
reeUSBS version %s.%s.%s\r\n", VERSION, PATCHLEVEL, =0ASUBLEVEL);=
</FONT><BR>&nbsp;&nbsp;Board_LEDInit(LED1);<BR>&nbsp;&nbsp;Board_=
LEDInit(LED2);<BR>&nbsp;&nbsp;Board_PBInit();<BR>&nbsp;down =0A<F=
ONT color=3D#333399>=3D</FONT> Board_PBGetState();<BR>&nbsp;<FONT=
 =0Acolor=3D#008000>//printf("down:%d\r\n", down);</FONT><BR>&nbs=
p;&nbsp;<FONT =0Acolor=3D#0000ff><B>if</B></FONT> (0x00 <FONT col=
or=3D#333399>=3D=3D</FONT> =0Adown)<BR>&nbsp;&nbsp;{ <FONT color=3D=
#008000>/* Test if user code is programmed =0Astarting from addre=
ss 0x800C000 */</FONT><BR>&nbsp;&nbsp;&nbsp;<FONT =0Acolor=3D#008=
000>//printf("Addr:0x%08X ,0x%08X\r\n", APP_DEFAULT_ADD, ((*(__IO=
 =0Auint32_t*)APP_DEFAULT_ADD) &amp; 0x2FFE0000 ));</FONT><BR>&nb=
sp;<FONT =0Acolor=3D#008000>//printf("Addr:0x%08X ,0x%08X\r\n", A=
PP_DEFAULT_ADD, (*(__IO =0Auint32_t*)APP_DEFAULT_ADD ));</FONT><B=
R>&nbsp;&nbsp;&nbsp;&nbsp;<FONT =0Acolor=3D#0000ff><B>if</B></FON=
T> (((<FONT color=3D#333399>*</FONT>(__IO =0Auint32_t<FONT color=3D=
#333399>*</FONT>)APP_DEFAULT_ADD) <FONT =0Acolor=3D#333399>&amp;<=
/FONT> 0x2FFE0000 ) <FONT color=3D#333399>=3D=3D</FONT> =0A0x2000=
0000)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{ <FONT color=3D#008000>/* Jump=20=
to user =0Aapplication */</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;JumpAddress <FONT =0Acolor=3D#333399>=3D</FONT> <FONT colo=
r=3D#333399>*</FONT>(__IO uint32_t<FONT =0Acolor=3D#333399>*</FON=
T>) (APP_DEFAULT_ADD <FONT color=3D#333399>+</FONT> <FONT =0Acolo=
r=3D#6e00aa>4</FONT>);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jum=
p_To_Application =0A<FONT color=3D#333399>=3D</FONT> (pFunction)=20=
=0AJumpAddress;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<FONT colo=
r=3D#008000>/* =0AInitialize user application's Stack Pointer =0A=
*/</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__set_MSP(<FONT=20=
=0Acolor=3D#333399>*</FONT>(__IO uint32_t<FONT color=3D#333399>*<=
/FONT>) =0AAPP_DEFAULT_ADD);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;Jump_To_Application();<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&=
nbsp;} =0A<FONT color=3D#008000>/* Otherwise enters DFU mode to a=
llow user to program his =0Aapplication */</FONT><BR>&nbsp;&nbsp;=
uart_init(<FONT =0Acolor=3D#6e00aa>115200</FONT>);<BR>&nbsp;&nbsp=
;printf(<FONT =0Acolor=3D#ff00bf>"QiFreeUSBS version %s.%s.%s\r\n=
"</FONT>, VERSION, PATCHLEVEL, =0ASUBLEVEL);</DIV>=0A<P class=3DM=
soNormal =0Astyle=3D"MARGIN: 0cm 0cm 0pt; WORD-SPACING: 0px; FONT=
: 12px/16px =CB=CE=CC=E5; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0)=
; TEXT-INDENT: 0px; WHITE-SPACE: normal; LETTER-SPACING: normal;=20=
orphans: auto; widows: auto; webkit-text-stroke-width: 0px"><BR>=C8=
=BB=BA=F3 =0ABuild=B2=A2 Download=BE=CD=BF=C9=D2=D4=D5=FD=B3=A3=D2=
=FD=B5=BC App=C1=CB=A1=A3=B2=A2=C7=D2=B4=AE=BF=DA=BD=AB=C8=E7=CE=D2=
=C3=C7=D4=A4=C6=DA=B5=C4=C4=C7=D1=F9=CA=E4=B3=F6=A3=BA<BR></P>=0A=
<DIV =0Astyle=3D"BORDER-RIGHT: black 1px solid; PADDING-RIGHT: 3p=
x; BORDER-TOP: black 1px solid; PADDING-LEFT: 3px; FONT-SIZE: 12p=
x; MARGIN-LEFT: auto; BORDER-LEFT: black 1px solid; COLOR: black;=
 MARGIN-RIGHT: auto; PADDING-TOP: 3px; BORDER-BOTTOM: black 1px s=
olid; FONT-FAMILY: Courier New; BACKGROUND-COLOR: window; TEXT-AL=
IGN: left; 3px: ">QiFreeUSBS =0AApp Test <FONT color=3D#6e00aa>1<=
/FONT>.<FONT color=3D#6e00aa>24</FONT>.<FONT =0Acolor=3D#6e00aa>8=
</FONT><BR>App Test ...<BR>App Test ...<BR>App Test ...<BR>App =0A=
Test ...<BR>App Test ...</DIV>=0A<P class=3DMsoNormal =0Astyle=3D=
"MARGIN: 0cm 0cm 0pt; WORD-SPACING: 0px; FONT: 12px/16px =CB=CE=CC=
=E5; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0); TEXT-INDENT: 0px; W=
HITE-SPACE: normal; LETTER-SPACING: normal; orphans: auto; widows=
: auto; webkit-text-stroke-width: 0px"><BR>=D4=DA=B5=E7=C4=D4=C9=CF=
=BB=B9=BF=C9=D2=D4=BF=B4=B5=BD=D2=BB=B8=F6=B4=C5=C5=CC=A1=A3=B5=AB=
=B4=CB=CA=B1=B4=C5=C5=CC=CA=C7=B2=BB=C4=DC=B8=F1=CA=BD=BB=AF=B5=C4=
=A3=AC=D2=F2=CE=AA=B5=B1=CA=B1=CE=D2=C3=C7=B2=A2=C3=BB=D3=D0=CA=B5=
=CF=D6 =0ASRAM=B9=D2=D4=D8=A1=A3=D6=AE=CB=F9=D2=D4=D1=A1=D4=F1 US=
BS_V0.5.21=C0=B4=D6=C6=D7=F7=D2=BB=B8=F6 App=D4=AD=D2=F2=D3=D0=C1=
=BD=B8=F6=A3=AC=D2=BB=CA=C7=BF=C9=D2=D4=CD=A8=B9=FD=B4=AE=BF=DA=B9=
=DB=B2=EC=CF=D6=CF=F3(=BC=B4=CA=B9=CA=C7=C4=E3=B5=C4=B0=E5=D7=D3=C3=
=BB=D3=D0 =0ALED)=A3=AC=B6=FE=CA=C7=B8=C3=B3=CC=D0=F2=CA=B9=D3=C3=
=C1=CB=D6=D0=B6=CF=A1=A3=CB=F9=D2=D4 NVIC_SetVectorTable=BA=AF=CA=
=FD=CA=C7=D2=F2=CE=AA=CE=D2=C3=C7=D0=E8=D2=AA=C9=E8=D6=C3=D6=D0=B6=
=CF=CF=F2=C1=BF=B1=ED=A1=A3=D2=F2=CE=AA =0AApp=CF=E0=B6=D4=D3=DA=C5=
=DC=D4=AD=C0=B4=C3=BB=D3=D0=D7=F6=B9=CC=BC=FE=C9=FD=BC=B6=CA=B1=B5=
=C4=B4=E6=B4=A2=B5=D8=D6=B7=B1=E4=C1=CB=A3=AC=C4=C7=C3=B4=D6=D0=B6=
=CF=CF=F2=C1=BF=B1=ED=B5=C4=CE=BB=D6=C3=D2=B2=B1=D8=C8=BB=BB=E1=B8=
=C4=B1=E4=A3=AC=B5=AB=CA=C7 App=D4=CB=D0=D0=B5=C4=CA=B1=BA=F2=C8=E7=
=B9=FB=C5=DC=B5=BD =0AUSBS=B5=C4=D6=D0=B6=CF=C0=EF=B1=DF=C8=A5=C1=
=CB=D5=E2=BF=CF=B6=A8=CA=C7=B2=BB=D0=D0=B5=C4=A3=AC=CB=F9=D2=D4=CE=
=D2=C3=C7=D2=AA=B8=E6=CB=DF MCU=D6=D0=B6=CF=CF=F2=C1=BF=B1=ED=B5=C4=
=CA=B5=BC=CA=CE=BB=D6=C3=A1=A3<BR><BR>&nbsp;&nbsp;&nbsp; =0A<STRO=
NG><SPAN id=3Dwiz_font_size_span_25854812 =0Astyle=3D"FONT-SIZE:=20=
16pt"><STRONG>=B5=BD</STRONG></SPAN></STRONG>=D5=E2=C0=EF=CE=D2=C3=
=C7=CA=B5=BC=CA=C9=CF=D2=D1=BE=AD=CA=B5=CF=D6=C1=CB=D2=BB=B8=F6=D7=
=EE=BB=F9=B1=BE=B5=C4 =0ABootloader=C1=CB=A3=AC=B5=AB=CA=C7=CE=D2=
=C3=C7=D4=DA=BC=EC=B2=E2=B0=B4=BC=FC=B5=C4=CA=B1=BA=F2=D6=BB=B2=C9=
=BC=AF=C1=CB=D2=BB=B4=CE=D0=C5=BA=C5=D5=E2=CF=D4=C8=BB=CA=C7=B2=BB=
=CD=D7=B5=B1=B5=C4=A3=AC=C4=C7=C3=B4=CF=C2=D2=BB=BD=DA=CE=D2=C3=C7=
=BD=AB=B6=D4=B4=CB=BD=F8=D0=D0=B4=A6=C0=ED=A1=A3<BR><BR><BR></P><=
/BODY></HTML>=0A

------=_Next_Part_0058331734.942--

------=_Next_Part_0174995202.995--

